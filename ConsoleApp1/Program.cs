using System;
using System.Collections.Generic;
using System.IO;
using System.Net;
using System.Net.Mail;
using System.Net.Mime;
using System.Text;

namespace ConsoleApp1
{
    class Program
    {
           static string smtpAddress = "smtp.gmail.com";
            static int portNumber = 587;
            static bool enableSSL = true;
            static string emailFromAddress = "lijojd@gmail.com"; //Sender Email Address  
            static string password = "lijolala"; //Sender Password  
            static string emailToAddress = "lijojolly@yahoo.com"; //Receiver Email Address  
            static string subject = "Hello";
            static string body = "Hello, This is Email sending test using gmail.";
        static List<Attachment> attachments = new List<Attachment>();
           
        static void Main(string[] args)
        {            
            {
                SendEmail();
            }
        }

        public static void SendEmail()
        {
            var strJson = "{\"ID\":\"52c25076-bb62-43dd-a76d-9613506b935d\",\"Name\":\"Create/Update CORE Ticket\",\"Environment\":\"production\",\"Tenant\":\"internal\",\"Category\":[\"Standard Actions:CORE\"],\"Outputs\":[{\"Name\":\"TicketNumber\",\"Type\":\"Xpath\",\"OutputExpression\":\"//TicketObject/ticketNumber\"},{\"Name\":\"ErrorHandlingEmailSent\",\"Type\":\"Xpath\",\"OutputExpression\":\"//TicketObject/errorHandlingEmailSent\"}],\"TimeOut\":\"00:00:00\",\"TimeOutTicks\":0,\"Type\":\"ACTION\",\"DefaultProperties\":{\"Severity\":\"1\",\"Priority\":\"1\",\"Account\":\"{\\\"IsEventAccount\\\":\\\"true\\\",\\\"EventAccount\\\":\\\"$[AccountID]\\\",\\\"Account\\\":\\\"\\\"}\",\"Computers\":\"{\\\"IsEventComputers\\\":\\\"true\\\",\\\"EventComputers\\\":\\\"$[DeviceID]\\\",\\\"Computers\\\":\\\"\\\"}\",\"accountManagerEmail\":\"$[Account_Contacts_Manager:Email]\",\"SendEmail\":\"true\",\"ATRQueueRuleID\":\"Always Update\",\"ticketReportingOption\":\"{\\\"Type\\\":\\\"Use Process Settings\\\",\\\"TRO_Target\\\":\\\"$[Variable:TRO_Target]\\\",\\\"TRO_Type\\\":\\\"$[Variable:TRO_Type]\\\"}\",\"activeTicketRule\":\"Use Process Settings\",\"TicketNumber\":\"{\\\"TicketType\\\":\\\"Process Ticket\\\",\\\"TicketNumber\\\":\\\"$[TicketVariable:TicketNumber:Process Ticket:1]\\\",\\\"SelectedTicket\\\":\\\"$[TicketVariable:TicketNumber:Process Ticket:1]\\\"}\",\"CreateOrUpdate\":\"create\",\"crt_QueueList\":\"Smart Queue\",\"crt_QueueID\":\"Support\",\"crt_StatusID\":\"{\\\"SelectedStatus\\\":\\\"--Select--\\\",\\\"DefinedStatus\\\":\\\" \\\"}\",\"crt_SubCategoryId\":\"Default\",\"crt_Bbcode\":\"false\",\"crt_ticketVisibility\":\"{\\\"TicketVisibleType\\\":\\\"1\\\",\\\"TicketVisibilityText\\\":\\\"\\\",\\\"isprivate\\\":\\\"false\\\"}\",\"upd_ticketVisibility\":\"{\\\"UseCreateTicketTicketVisible\\\":true,\\\"TicketVisibleType\\\":\\\"1\\\",\\\"TicketVisibilityText\\\":\\\"\\\",\\\"isprivate\\\":\\\"false\\\"}\",\"MessageText\":\"{\\\"UseCreateTicketMessage\\\":true, \\\"UpdateTicketMessage\\\":\\\"\\\"}\",\"Routing\":\"leaveasis\",\"upd_QueueList\":\"Smart Queue\",\"upd_QueueID\":\"Support\",\"upd_StatusID\":\"{\\\"SelectedStatus\\\":\\\"leaveasis\\\",\\\"DefinedStatus\\\":\\\" \\\"}\",\"QueueRuleID\":\"Always Update\",\"upd_SubCategoryId\":\"leaveasis\",\"SeverityID\":\"leaveasis\",\"PriorityId\":\"leaveasis\",\"upd_Account\":\"$[AccountID]\",\"upd_Computers\":\"$[DeviceID]\",\"upd_Subject\":\"leaveasis\",\"upd_Bbcode\":\"false\",\"Subject\":\"leaveasis\",\"crt_SmartQueueType\":\"segment\",\"upd_SmartQueueType\":\"segment\"},\"FixedProperties\":{\"IsErrorAll\":\"false\",\"enterprisePermissions\":\"$[Variable:isEnterpisePermissions]\",\"eventJson\":\"$[event]\",\"osType\":\"$[OS_Type]\",\"Tenant\":\"$[TenantID]\",\"TRO_Target\":\"$[Variable:TRO_Target]\",\"TRO_Type\":\"$[Variable:TRO_Type]\",\"contactErrorSettings\":\"$[Variable:Contacts_Permission_Error_Handling]\",\"contactErrorFrom\":\"support@rackspace.com\",\"contactErrorTo\":\"[STARTJSONENCODE]$[Contact:BH:Account:core:rackspace:Account Manager:Email][ENDJSONENCODE],$[Contact:BH:Account:core:rackspace:Primary Lead Tech:Email]\",\"contactErrorAllSubject\":\"ARIC 3.0 – Permissions-Based Errors (All Contacts Failed) - $[AccountID] - $[AccountName]\",\"contactErrorAllBody\":\"$[Contact:BH:Account:core:rackspace:Account Manager:FullName],<br /> In the Process of creating a ticket (<<<TICKET_NUMBER>>>) for Account #$[AccountID] - $[AccountName], a potential issue with contacts has been uncovered.<br />None of the selected contacts in your customer's process have the appropriate permissions for the alerting device.<br />For this reason, the ticket was created with all contacts included who have the appropriate permissions.<br />Below are the details:<br />EVENT: $[FriendlyName]<br />DATE/TIME: $[EntryTimestamp]<br />ACCOUNT: $[AccountID] - $[AccountName]<br />DEVICE: $[DeviceID] - $[DeviceName]<br />TICKET: <<<TICKET_LINK>>> <br />CONTACTS AS DEFINED IN PROCESS: <<<ALL_CONTACTS>>> <br />CONTACTS ACTUALLY ADDED TO TICKET: <<<SUCCESS_CONTACTS>>> <br />To correct this issue, please go to the following process and select the appropriate contacts:<br />PROCESS: $[ProcessURN]<br />EVENT ID: $[EventID]\",\"contactErrorAnySubject\":\"ARIC 3.0 – Permissions-Based Errors (A Single Contact Failed) - $[AccountID] - $[AccountName]\",\"contactErrorAnyBody\":\"$[Contact:BH:Account:core:rackspace:Account Manager:FullName],<br />In the Process of creating a ticket (<<<TICKET_NUMBER>>>) for Account #$[AccountID] - $[AccountName], a potential issue with contacts has been uncovered.<br />One of the selected contacts in your customer's process doesn't have the appropriate permissions for the alerting device.<br />For this reason, the ticket was created with the remaining contacts included who actually do have the appropriate permissions.<br />Below are the details:<br />EVENT: $[FriendlyName]<br />DATE/TIME: $[EntryTimestamp]<br />ACCOUNT: $[AccountID] - $[AccountName]<br />DEVICE: $[DeviceID] - $[DeviceName]<br />TICKET: <<<TICKET_LINK>>><br />CONTACTS AS DEFINED IN PROCESS: <<<ALL_CONTACTS>>> <br />CONTACTS ACTUALLY ADDED TO TICKET: <<<SUCCESS_CONTACTS>>> <br />CONTACTS WHO FAILED EPM: <<<FAILED_CONTACTS>>> <br />To correct this issue, please go to the following process and select the appropriate contacts:<br />PROCESS: $[ProcessURN]<br />EVENT ID: $[EventID]<br />Your process dictates you're to receive an email when any contact fails the enterprise permissions check upon new ticket creation.<br />If you'd like to change this setting, <br />you can go to the above process and modify the \\\"Contacts – Permissions-Based Error Handling\\\" to be set to \\\"All\\\" rather than \\\"Individual\\\"\",\"contacts\":\"$[ProcessContacts]\",\"eventID\":\"$[EventID]\",\"Targets\":\"$[Target]\",\"ProcessQueueRuleID\":\"$[Variable:SelectedRuleSet]\",\"IsClear\":\"$[Variable:IsClear_SSCOutput]\"},\"PropertyDefinitions\":{\"Message\":{\"Presentation\":{\"Position\":{\"Row\":[10],\"Column\":[2,3,4,5]},\"Type\":\"Textarea\"},\"Rules\":[{\"Name\":\"ShowHideCreateUpdateProperty\",\"Event\":\"OnLoad\"}]},\"Severity\":{\"Presentation\":{\"Type\":\"Dropdown List\",\"Position\":{\"Row\":[12],\"Column\":[2,3,4,5]}},\"Source\":{\"Type\":\"External\",\"Execution\":{\"APIIntegratorGroupID\":\"be869cb3-3e4d-4c71-98b2-881387ef055f\"}},\"Rules\":[{\"Name\":\"ShowHideCreateUpdateProperty\",\"Event\":\"OnLoad\"}]},\"Priority\":{\"Presentation\":{\"Type\":\"Dropdown List\",\"Position\":{\"Row\":[13],\"Column\":[2,3,4,5]}},\"Source\":{\"Type\":\"External\",\"Execution\":{\"APIIntegratorGroupID\":\"a94431e7-a572-4bb4-abfc-4a7707ac9e67\"}},\"Rules\":[{\"Name\":\"ShowHideCreateUpdateProperty\",\"Event\":\"OnLoad\"}]},\"Account\":{\"Presentation\":{\"Type\":\"defaultradiotext\",\"Position\":{\"Row\":[15],\"Column\":[2,3,4,5,6]}},\"Rules\":[{\"Name\":\"ShowHideCreateUpdateProperty\",\"Event\":\"OnLoad\"}]},\"Computers\":{\"Presentation\":{\"Type\":\"defaultradiotext\",\"Position\":{\"Row\":[16],\"Column\":[2,3,4,5,6]}},\"Rules\":[{\"Name\":\"ShowHideCreateUpdateProperty\",\"Event\":\"OnLoad\"}]},\"SendEmail\":{\"Presentation\":{\"Type\":\"Checkbox\",\"Position\":{\"Row\":[29],\"Column\":[2,3,4,5]}}},\"TicketNumber\":{\"Presentation\":{\"Position\":{\"Row\":[1],\"Column\":[2,3,4,5]},\"Type\":\"ticketcontrol\"},\"Rules\":[]},\"ticketReportingOption\":{\"Presentation\":{\"Position\":{\"Row\":[2],\"Column\":[1,2,3,4,5,6]},\"Type\":\"ticketreportingoption\",\"Rules\":null},\"Rules\":[{\"Name\":\"FormatTROType\",\"Event\":\"OnSubmit\"}]},\"activeTicketRule\":{\"Presentation\":{\"Type\":\"activeticketrule\",\"Position\":{\"Row\":[3],\"Column\":[1,2,3,4,5,6]}}},\"ATRQueueRuleID\":{\"Presentation\":{}},\"CreateOrUpdate\":{\"Presentation\":{\"Position\":{\"Row\":[4],\"Column\":[1,2,3,4,5,6]},\"Type\":\"CreateOrUpdate\"}},\"crt_QueueList\":{\"Presentation\":{\"Type\":\"Radio Button List Horizontal\",\"Position\":{\"Row\":[5],\"Column\":[2,3,4,5,6]}},\"Rules\":[{\"Name\":\"LoadQueueList\",\"Event\":\"OnChange\"},{\"Name\":\"ShowHideCreateUpdateProperty\",\"Event\":\"OnLoad\"}],\"Source\":{\"Type\":\"Fixed\",\"Fixed\":{\"Items\":{\"Smart Queue\":\"Smart Queue\",\"Standard Queue\":\"Standard Queue\"}}}},\"crt_QueueID\":{\"Presentation\":{\"Position\":{\"Row\":[6],\"Column\":[2,3,4,5,6]},\"Type\":\"dropdownqueue\"},\"Rules\":[{\"Name\":\"LoadQueueStatus\",\"Event\":\"OnChange\"},{\"Name\":\"SetTypeProperty\",\"Event\":\"OnLoad\"},{\"Name\":\"ShowHideCreateUpdateProperty\",\"Event\":\"OnLoad\"}]},\"crt_StatusID\":{\"Presentation\":{\"Type\":\"singledropdowntext\",\"Position\":{\"Row\":[7],\"Column\":[2,3,4,5]}},\"Rules\":[{\"Name\":\"ShowHideCreateUpdateProperty\",\"Event\":\"OnLoad\"}]},\"crt_SubCategoryId\":{\"Presentation\":{\"Type\":\"dropdownqueue\",\"Position\":{\"Row\":[8],\"Column\":[2,3,4,5]}},\"Rules\":[{\"Name\":\"ShowHideCreateUpdateProperty\",\"Event\":\"OnLoad\"}]},\"crt_Subject\":{\"Presentation\":{\"Position\":{\"Row\":[9],\"Column\":[2,3,4,5]},\"Type\":\"Textbox\"},\"Rules\":[{\"Name\":\"ShowHideCreateUpdateProperty\",\"Event\":\"OnLoad\"}]},\"crt_Bbcode\":{\"Presentation\":{\"Type\":\"Checkbox\",\"Position\":{\"Row\":[11],\"Column\":[2,3,4,5]}},\"Rules\":[{\"Name\":\"ShowHideCreateUpdateProperty\",\"Event\":\"OnLoad\"}],\"Source\":{\"Type\":\"Fixed\",\"Fixed\":{\"Items\":{\"Message_Contains_BBCode\":0}}}},\"crt_ticketVisibility\":{\"Presentation\":{\"Position\":{\"Row\":[14],\"Column\":[2,3,4,5]},\"Type\":\"TicketVisibility\"},\"Rules\":[{\"Name\":\"ShowHideCreateUpdateProperty\",\"Event\":\"OnLoad\"}]},\"Routing\":{\"Presentation\":{\"Type\":\"Dropdown List\",\"Position\":{\"Row\":[17],\"Column\":[2,3,4,5]}},\"Rules\":[{\"Name\":\"ShowHideScm\",\"Event\":\"OnChange\"},{\"Name\":\"IncludeLeaveAsIs\",\"Event\":\"OnLoad\"},{\"Name\":\"ShowHideCreateUpdateProperty\",\"Event\":\"OnLoad\"}],\"Source\":{\"Type\":\"Fixed\",\"Fixed\":{\"Items\":{\"Leave as is\":\"leaveasis\",\"Set Queue / Status\":\"Set Queue / Status\",\"Use Status Code Matrix\":\"Use Status Code Matrix\"}}}},\"upd_QueueList\":{\"Presentation\":{\"Type\":\"Radio Button List Horizontal\",\"Position\":{\"Row\":[18],\"Column\":[2,3,4,5,6]}},\"Rules\":[{\"Name\":\"IncludeLeaveAsIs\",\"Event\":\"OnLoad\"},{\"Name\":\"LoadQueueList\",\"Event\":\"OnChange\"},{\"Name\":\"ShowHideProperty\",\"Event\":\"OnLoad\"},{\"Name\":\"ShowHideCreateUpdateProperty\",\"Event\":\"OnLoad\"}],\"Source\":{\"Type\":\"Fixed\",\"Fixed\":{\"Items\":{\"Smart Queue\":\"Smart Queue\",\"Standard Queue\":\"Standard Queue\"}}}},\"upd_QueueID\":{\"Presentation\":{\"Position\":{\"Row\":[19],\"Column\":[2,3,4,5,6]},\"Type\":\"dropdownqueue\"},\"Rules\":[{\"Name\":\"IncludeLeaveAsIs\",\"Event\":\"OnLoad\"},{\"Name\":\"LoadQueueStatus\",\"Event\":\"OnChange\"},{\"Name\":\"ShowHideProperty\",\"Event\":\"OnLoad\"},{\"Name\":\"SetTypeProperty\",\"Event\":\"OnLoad\"},{\"Name\":\"ShowHideCreateUpdateProperty\",\"Event\":\"OnLoad\"}]},\"upd_StatusID\":{\"Presentation\":{\"Type\":\"singledropdowntext\",\"Position\":{\"Row\":[20],\"Column\":[2,3,4,5]}},\"Rules\":[{\"Name\":\"IncludeLeaveAsIs\",\"Event\":\"OnLoad\"},{\"Name\":\"ShowHideProperty\",\"Event\":\"OnLoad\"},{\"Name\":\"ShowHideCreateUpdateProperty\",\"Event\":\"OnLoad\"}]},\"QueueRuleID\":{\"Presentation\":{\"Type\":\"dropdownbutton\",\"Position\":{\"Row\":[21],\"Column\":[2,3,4,5]}},\"Rules\":[{\"Name\":\"ShowHideProperty\",\"Event\":\"OnLoad\"},{\"Name\":\"ShowHideCreateUpdateProperty\",\"Event\":\"OnLoad\"}]},\"upd_SubCategoryId\":{\"Presentation\":{\"Type\":\"dropdownqueue\",\"Position\":{\"Row\":[22],\"Column\":[2,3,4,5]}},\"Rules\":[{\"Name\":\"IncludeLeaveAsIs\",\"Event\":\"OnLoad\"},{\"Name\":\"ShowHideProperty\",\"Event\":\"OnLoad\"},{\"Name\":\"ShowHideCreateUpdateProperty\",\"Event\":\"OnLoad\"}]},\"upd_Subject\":{\"Presentation\":{\"Position\":{\"Row\":[23],\"Column\":[2,3,4,5]},\"Type\":\"checkboxtext\"},\"Rules\":[{\"Name\":\"ShowHideCreateUpdateProperty\",\"Event\":\"OnLoad\"}]},\"MessageText\":{\"Presentation\":{\"Position\":{\"Row\":[24],\"Column\":[2,3,4,5]},\"Type\":\"checkboxtextarea\"},\"Rules\":[{\"Name\":\"ShowHideCreateUpdateProperty\",\"Event\":\"OnLoad\"}]},\"upd_Bbcode\":{\"Presentation\":{\"Type\":\"Checkbox\",\"Position\":{\"Row\":[25],\"Column\":[2,3,4,5]}},\"Rules\":[{\"Name\":\"ShowHideCreateUpdateProperty\",\"Event\":\"OnLoad\"}],\"Source\":{\"Type\":\"Fixed\",\"Fixed\":{\"Items\":{\"Message_Contains_BBCode\":0}}}},\"SeverityID\":{\"Presentation\":{\"Type\":\"Dropdown List\",\"Position\":{\"Row\":[26],\"Column\":[2,3,4,5]}},\"Rules\":[{\"Name\":\"IncludeLeaveAsIs\",\"Event\":\"OnLoad\"},{\"Name\":\"ShowHideCreateUpdateProperty\",\"Event\":\"OnLoad\"}],\"Source\":{\"Type\":\"Fixed\",\"Fixed\":{\"Items\":{\" Leave as is\":\"leaveasis\",\"Standard\":\"1\",\"Urgent\":\"2\",\"Emergency\":\"3\"}}}},\"PriorityId\":{\"Presentation\":{\"Type\":\"Dropdown List\",\"Position\":{\"Row\":[27],\"Column\":[2,3,4,5]}},\"Rules\":[{\"Name\":\"IncludeLeaveAsIs\",\"Event\":\"OnLoad\"},{\"Name\":\"ShowHideCreateUpdateProperty\",\"Event\":\"OnLoad\"}],\"Source\":{\"Type\":\"Fixed\",\"Fixed\":{\"Items\":{\" Leave as is\":\"leaveasis\",\"Normal\":\"1\",\"Low\":\"2\",\"High\":\"3\",\"Highest\":\"4\"}}}},\"upd_ticketVisibility\":{\"Presentation\":{\"Position\":{\"Row\":[28],\"Column\":[2,3,4,5]},\"Type\":\"TicketVisibilityCheckbox\"},\"Rules\":[{\"Name\":\"ShowHideCreateUpdateProperty\",\"Event\":\"OnLoad\"}]},\"crt_SmartQueueType\":{\"Presentation\":{}},\"upd_SmartQueueType\":{\"Presentation\":{}},\"EventBHType\":{\"Presentation\":{}}},\"Execution\":{\"LibraryInfo\":{\"AssemblyLocation\":\"C:\\\\EventAggregator\\\\QueueProcessor\\\\Actions\\\\eventprocessing.pcem.action.v1.manager.dll\",\"ClassName\":\"eventprocessing.pcem.action.v1.manager.CreateUpdateCORETicket\",\"Method\":\"CreateUpdateWithErrorHandlingAndIsClearOption\"}},\"Labels\":[{\"Text\":\"Select Ticket\",\"Position\":{\"Row\":[1],\"Column\":[1,2]}},{\"Text\":\"Routing\",\"Position\":{\"Row\":[5],\"Column\":[1]}},{\"Text\":\"Queue\",\"Position\":{\"Row\":[6],\"Column\":[1]}},{\"Text\":\"Status\",\"Position\":{\"Row\":[7],\"Column\":[1]}},{\"Text\":\"Category\",\"Position\":{\"Row\":[8],\"Column\":[1]}},{\"Text\":\"Subject\",\"Position\":{\"Row\":[9],\"Column\":[1]}},{\"Text\":\"Message\",\"Position\":{\"Row\":[10],\"Column\":[1]}},{\"Text\":\"Severity\",\"Position\":{\"Row\":[12],\"Column\":[1]}},{\"Text\":\"Priority\",\"Position\":{\"Row\":[13],\"Column\":[1]}},{\"Text\":\"TicketVisibility\",\"Position\":{\"Row\":[14],\"Column\":[1]}},{\"Text\":\"Account Info\",\"Position\":{\"Row\":[15],\"Column\":[1]}},{\"Text\":\"Server Info\",\"Position\":{\"Row\":[16],\"Column\":[1]}},{\"Text\":\"Queue\",\"Position\":{\"Row\":[17],\"Column\":[1]}},{\"Text\":\"Routing\",\"Position\":{\"Row\":[18],\"Column\":[1]}},{\"Text\":\"Status\",\"Position\":{\"Row\":[20],\"Column\":[1]}},{\"Text\":\"Status Code Matrix\",\"Position\":{\"Row\":[21],\"Column\":[1]}},{\"Text\":\"Category\",\"Position\":{\"Row\":[22],\"Column\":[1]}},{\"Text\":\"Subject\",\"Position\":{\"Row\":[23],\"Column\":[1]}},{\"Text\":\"Message\",\"Position\":{\"Row\":[24],\"Column\":[1]}},{\"Text\":\"Severity\",\"Position\":{\"Row\":[26],\"Column\":[1]}},{\"Text\":\"Priority\",\"Position\":{\"Row\":[27],\"Column\":[1]}},{\"Text\":\"Ticket Visibility\",\"Position\":{\"Row\":[28],\"Column\":[1]}},{\"Text\":\"Send Email\",\"Position\":{\"Row\":[29],\"Column\":[1]}}],\"LastModifiedDate\":\"2017-06-29T15:40:04.2452803Z\",\"LastModifiedBy\":\"sent1476\",\"HasExecuteAccess\":true,\"HasWriteAccess\":false,\"HasOwnerAccess\":false,\"HasOnlyWriteAccess\":false,\"Matrix\":[]}";

            MemoryStream ms = new MemoryStream(ASCIIEncoding.ASCII.GetBytes(strJson));
            System.Net.Mime.ContentType ct = new System.Net.Mime.ContentType(System.Net.Mime.MediaTypeNames.Text.Plain);
            System.Net.Mail.Attachment attachment = new System.Net.Mail.Attachment(ms, ct);
            attachment.ContentDisposition.FileName = "myFile1.json";
            attachments.Add(attachment);

            ms = new MemoryStream(ASCIIEncoding.ASCII.GetBytes(strJson));
            attachment = new System.Net.Mail.Attachment(ms, ct);
            attachment.ContentDisposition.FileName = "myFile2.json";
            attachments.Add(attachment);

            using (MailMessage mail = new MailMessage())
            {
                mail.From = new MailAddress(emailFromAddress);
                mail.To.Add(emailToAddress);
                mail.Subject = subject;
                mail.Body = body;
                mail.IsBodyHtml = true;

                attachments.ForEach(o => mail.Attachments.Add(o));

                using (SmtpClient smtp = new SmtpClient(smtpAddress, portNumber))
                {
                    smtp.Credentials = new NetworkCredential(emailFromAddress, password);
                    smtp.EnableSsl = enableSSL;
                    smtp.Send(mail);

                    ms.Flush();
                }
            }
        }
    }
}
